---
title: "file:xlsx Extractor"
description: Extract text and data from Excel spreadsheets.
---

The `file:xlsx` extractor reads Excel spreadsheets and converts them to text. It walks through each sheet, capturing cell values, formulas (as their computed results), and sheet names.

Spreadsheets are tricky for semantic search—a grid of numbers isn't inherently searchable. The extractor focuses on extracting meaningful text: headers, labels, text cells, and optionally tabular data in a readable format.

## Installation

```bash
bunx unrag add extractor file-xlsx
```

Register in your config:

```ts
import { createFileXlsxExtractor } from "./lib/unrag/extractors/file-xlsx";

export const unrag = defineUnragConfig({
  // ...
  engine: {
    // ...
    extractors: [createFileXlsxExtractor()],
  },
} as const);
```

## What gets extracted

For each sheet in the workbook:

- **Sheet name** — Used as a section header
- **Text cells** — String values from cells
- **Numbers** — Numeric values (when `includeNumbers: true`)
- **Formula results** — Computed values, not the formula itself
- **Headers** — First row treated as headers when `treatFirstRowAsHeader: true`

## Configuration

Enable and configure:

```ts
export const unrag = defineUnragConfig({
  // ...
  engine: {
    // ...
    assetProcessing: {
      file: {
        xlsx: {
          enabled: true,
          maxBytes: 50 * 1024 * 1024,    // 50MB limit
          maxOutputChars: 500_000,        // Truncate very large sheets
          maxSheets: 20,                  // Process up to 20 sheets
          maxRowsPerSheet: 10_000,        // Process up to 10k rows per sheet
          treatFirstRowAsHeader: true,    // Use first row as column headers
          includeNumbers: false,          // Skip purely numeric data
          format: "text",                 // Output format: "text" | "csv" | "markdown"
        },
      },
    },
  },
} as const);
```

### Options

| Option | Default | Description |
|--------|---------|-------------|
| `enabled` | `false` | Whether to process Excel files |
| `maxBytes` | `50MB` | Maximum file size |
| `maxOutputChars` | `500000` | Truncate output beyond this |
| `maxSheets` | `20` | Maximum sheets to process |
| `maxRowsPerSheet` | `10000` | Maximum rows per sheet |
| `treatFirstRowAsHeader` | `true` | Use first row as column headers |
| `includeNumbers` | `false` | Include numeric-only cells |
| `format` | `"text"` | Output format for the extracted data |

### Output formats

- **`text`** — Natural prose-like format with key-value pairs
- **`csv`** — Comma-separated values (good for structured data)
- **`markdown`** — Markdown tables (good for tabular presentation)

## Usage example

### Ingesting a spreadsheet

```ts
import { readFile } from "node:fs/promises";

const xlsxBuffer = await readFile("./data/inventory.xlsx");

await engine.ingest({
  sourceId: "inventory:2024-q3",
  content: "Q3 2024 Inventory Report",
  assets: [
    {
      assetId: "inventory-xlsx",
      kind: "file",
      data: {
        kind: "bytes",
        bytes: new Uint8Array(xlsxBuffer),
        mediaType: "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",
        filename: "inventory.xlsx",
      },
    },
  ],
});
```

### From a URL

```ts
await engine.ingest({
  sourceId: "finance:budget",
  content: "2024 Department Budget",
  assets: [
    {
      assetId: "budget-xlsx",
      kind: "file",
      data: {
        kind: "url",
        url: "https://storage.example.com/finance/budget-2024.xlsx",
        mediaType: "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",
      },
    },
  ],
});
```

## Example outputs

### Text format

With `format: "text"`, the output reads like:

```
Sheet: Employees

Name: Alice Johnson
Department: Engineering
Start Date: 2021-03-15
Role: Senior Developer

Name: Bob Smith
Department: Design
Start Date: 2022-07-01
Role: UX Designer

...
```

### Markdown format

With `format: "markdown"`:

```markdown
## Sheet: Employees

| Name | Department | Start Date | Role |
|------|------------|------------|------|
| Alice Johnson | Engineering | 2021-03-15 | Senior Developer |
| Bob Smith | Design | 2022-07-01 | UX Designer |
```

## Chunk metadata

| Field | Value |
|-------|-------|
| `chunk.metadata.assetKind` | `"file"` |
| `chunk.metadata.assetId` | Your provided ID |
| `chunk.metadata.extractor` | `"file:xlsx"` |

## Tips for spreadsheet search

### Focus on text-heavy sheets

Spreadsheets full of numbers without context don't search well. The extractor works best on sheets that have:

- Text headers that describe columns
- Label columns (product names, employee names, etc.)
- Notes or comment columns

### Consider excluding numeric-only data

Set `includeNumbers: false` to skip cells that are purely numeric. This reduces noise in your search index while keeping meaningful text.

### Large spreadsheets

For very large workbooks:

- Use `maxSheets` to limit which sheets get processed
- Use `maxRowsPerSheet` to cap row extraction
- Consider splitting large sheets into multiple sources

## Limitations

- **Charts not extracted** — Chart titles and data aren't captured
- **Images skipped** — Embedded images aren't processed
- **Macros ignored** — VBA code isn't extracted
- **Pivot tables** — Only the visible values, not the underlying data

## Troubleshooting

### Empty output

- Check if sheets contain only numbers (use `includeNumbers: true`)
- Verify data starts in row 1 or adjust `treatFirstRowAsHeader`
- Make sure sheets aren't hidden

### Missing sheets

Check `maxSheets` limit—sheets beyond that count are skipped.

### Garbled formatting

Try a different `format` option. Markdown works well for tabular data; text works better for label-heavy sheets.

